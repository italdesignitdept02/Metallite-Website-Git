{%- comment -%}
  CUSTOM MEGA MENU - Hardcoded Version
  
  This snippet creates a custom mega menu with nested subcategories.
  You can customize the structure directly in this file.
  
  Parameters:
  - mega_menu: The menu object to render
  - index: Unique identifier for the menu
  - is_floating: Whether the menu is floating (condensed layout)
{%- endcomment -%}

{%- if section.settings.desktop_navigation_layout == 'condensed' -%}
  {%- assign is_condensed = true -%}
{%- else -%}
  {%- assign is_condensed = false -%}
{%- endif -%}

{%- assign downcase_title = mega_menu.title | downcase | strip -%}

{%- comment -%}
  CONFIGURATION: Define your mega menu structure here
  Add menu items that should have mega menus
{%- endcomment -%}

{%- assign mega_menu_items = 'lighting,furniture,brands,home improvement' | split: ',' -%}
{%- assign is_mega_menu_item = false -%}

{%- for item in mega_menu_items -%}
  {%- assign item_downcase = item | downcase | strip -%}
  {%- if downcase_title == item_downcase -%}
    {%- assign is_mega_menu_item = true -%}
    {%- break -%}
  {%- endif -%}
{%- endfor -%}

{%- if is_mega_menu_item -%}
  <div id="{{ index }}" class="mega-menu {% if is_floating %}mega-menu--floating{% endif %}" data-type="menu" aria-hidden="true" role="list">
    {%- capture mega_menu_inner -%}
      {%- assign should_center = false -%}

      {%- unless is_floating -%}
        {%- assign should_center = true -%}
      {%- endunless -%}

      {%- assign mega_menu_classes = '' -%}

      {%- if should_center and mega_menu.links.size <= 4 -%}
        {%- assign mega_menu_classes = 'mega-menu__inner--center mega-menu__inner--large' -%}
      {%- endif -%}

      <div class="mega-menu__inner {{ mega_menu_classes }}">
        {%- if mega_menu.links.size > 0 -%}
          {%- capture mega_menu_columns -%}
            {%- for link in mega_menu.links -%}
              <div class="mega-menu__column">
                <a href="{{ link.url }}" class="mega-menu__title heading">{{ link.title }}</a>

                {%- if link.links.size > 0 -%}
                  <ul class="mega-menu__linklist" role="list">
                    {%- for sub_link in link.links -%}
                      <li class="mega-menu__item">
                        <a href="{{ sub_link.url }}" class="mega-menu__link link">{{ sub_link.title }}</a>
                        
                        {%- comment -%}Nested subcategories (3rd level){%- endcomment -%}
                        {%- if sub_link.links.size > 0 -%}
                          <ul class="mega-menu__nested-list" role="list">
                            {%- for sub_sub_link in sub_link.links -%}
                              <li class="mega-menu__nested-item">
                                <a href="{{ sub_sub_link.url }}" class="mega-menu__nested-link link">{{ sub_sub_link.title }}</a>
                              </li>
                            {%- endfor -%}
                          </ul>
                        {%- endif -%}
                      </li>
                    {%- endfor -%}
                  </ul>
                {%- endif -%}
              </div>
            {%- endfor -%}
          {%- endcapture -%}

          {%- if is_floating -%}
            {%- comment -%}
            IMPLEMENTATION NOTE: 230 is the size in pixel of a given column (it's 170 + 60 of margin).
            {%- endcomment -%}
            <div class="mega-menu__column-list" style="width: {{ 230 | times: mega_menu.links.size }}px">
              {{- mega_menu_columns -}}
            </div>
          {%- else -%}
            {{- mega_menu_columns -}}
          {%- endif -%}
        {%- endif -%}

        {%- comment -%}
          CUSTOM PROMOTIONAL IMAGES
          Configure your promotional images here based on menu title
        {%- endcomment -%}
        
        {%- case downcase_title -%}
          {%- when 'lighting' -%}
            {%- comment -%}Add promotional images for Lighting category{%- endcomment -%}
            {%- assign promo_image_1 = 'your-lighting-promo-1.jpg' -%}
            {%- assign promo_heading_1 = 'Featured Lighting' -%}
            {%- assign promo_text_1 = 'Discover our latest collection' -%}
            {%- assign promo_link_1 = '/collections/featured-lighting' -%}
            
          {%- when 'furniture' -%}
            {%- comment -%}Add promotional images for Furniture category{%- endcomment -%}
            {%- assign promo_image_1 = 'your-furniture-promo-1.jpg' -%}
            {%- assign promo_heading_1 = 'Premium Furniture' -%}
            {%- assign promo_text_1 = 'Comfort meets style' -%}
            {%- assign promo_link_1 = '/collections/premium-furniture' -%}
            
          {%- when 'brands' -%}
            {%- comment -%}Add promotional images for Brands category{%- endcomment -%}
            {%- assign promo_image_1 = 'your-brands-promo-1.jpg' -%}
            {%- assign promo_heading_1 = 'Top Brands' -%}
            {%- assign promo_text_1 = 'Quality you can trust' -%}
            {%- assign promo_link_1 = '/collections/top-brands' -%}
        {%- endcase -%}

        {%- comment -%}Render promotional image if configured{%- endcomment -%}
        {%- if promo_image_1 and promo_image_1 != '' -%}
          <a href="{{ promo_link_1 | default: '#' }}" class="mega-menu__promo">
            <div class="mega-menu__image-wrapper">
              <div class="aspect-ratio" style="padding-bottom: 66.67%">
                {%- comment -%}Replace with actual image from Shopify files{%- endcomment -%}
                <img class="lazyload image--fade-in" data-src="{{ promo_image_1 | img_url: '550x' }}" alt="{{ promo_heading_1 | escape }}">
              </div>
            </div>

            <span class="mega-menu__image-heading heading h4">{{ promo_heading_1 | escape }}</span>
            <p class="mega-menu__image-text">{{ promo_text_1 | escape }}</p>
          </a>
        {%- endif -%}
      </div>
    {%- endcapture -%}

    {%- if is_condensed -%}
      {{- mega_menu_inner -}}
    {%- else -%}
      <div class="container">
        {{- mega_menu_inner -}}
      </div>
    {%- endif -%}
  </div>
{%- else -%}
  {%- comment -%}If not a mega menu item, render standard dropdown{%- endcomment -%}
  {%- render 'desktop-menu-standard', menu: mega_menu, index: index, is_floating: is_floating -%}
{%- endif -%}
